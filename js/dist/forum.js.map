{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@datlechin/flarum-discussion-overview/./src/forum/components/DiscussionOverview.tsx","webpack://@datlechin/flarum-discussion-overview/./src/forum/index.tsx","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['common/Component']\"","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['common/components/Link']\"","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['common/extend']\"","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['common/helpers/avatar']\"","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['forum/app']\"","webpack://@datlechin/flarum-discussion-overview/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@datlechin/flarum-discussion-overview/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@datlechin/flarum-discussion-overview/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@datlechin/flarum-discussion-overview/webpack/bootstrap","webpack://@datlechin/flarum-discussion-overview/webpack/runtime/compat get default export","webpack://@datlechin/flarum-discussion-overview/webpack/runtime/define property getters","webpack://@datlechin/flarum-discussion-overview/webpack/runtime/hasOwnProperty shorthand","webpack://@datlechin/flarum-discussion-overview/webpack/runtime/make namespace object"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport type Mithril from 'mithril';\nimport Discussion from 'flarum/common/models/Discussion';\nimport User from 'flarum/common/models/User';\nimport Post from 'flarum/common/models/Post';\nimport Link from 'flarum/common/components/Link';\nimport Tooltip from 'flarum/common/components/Tooltip';\nimport avatar from 'flarum/common/helpers/avatar';\nimport app from 'flarum/forum/app';\n\ninterface DiscussionOverviewAttrs {\n  discussion: Discussion;\n}\n\nexport default class DiscussionOverview extends Component<DiscussionOverviewAttrs> {\n  discussion!: Discussion;\n\n  oninit(vnode: Mithril.Vnode<DiscussionOverviewAttrs, this>): void {\n    super.oninit(vnode);\n    this.discussion = this.attrs.discussion;\n  }\n\n  view() {\n    const discussion = this.discussion;\n    const posts = discussion.posts() as Post[];\n    const participantCount = discussion.attribute<number>('participantCount');\n    const lastPost = posts?.[posts.length - 1] as Post;\n\n    const participantUsers = new Set<User>();\n    posts.forEach((post) => {\n      const user = post.user();\n      if (user) {\n        participantUsers.add(user);\n      }\n    });\n\n    return (\n      <>\n        <ul className=\"DiscussionOverview-list\">\n          <li className=\"created-at\">\n            <h4>{app.translator.trans('datlechin-discussion-overview.forum.created')}</h4>\n            <div className=\"time\">{dayjs(discussion.createdAt()).fromNow()}</div>\n          </li>\n          <li className=\"last-reply\">\n            <h4>{app.translator.trans('datlechin-discussion-overview.forum.last_reply')}</h4>\n            <Link href={app.route.post(lastPost)}>\n              <div className=\"time\">\n                {avatar(lastPost.user())}\n                {dayjs(discussion.lastPostedAt()).fromNow()}\n              </div>\n            </Link>\n          </li>\n          <li className=\"replies\">\n            <span className=\"number\">{discussion.replyCount()}</span>\n            <h4>{app.translator.trans('datlechin-discussion-overview.forum.replies')}</h4>\n          </li>\n          {app.initializers.has('michaelbelgium-discussion-views') ? (\n            <li className=\"views\">\n              <span className=\"number\">{discussion.viewCount()}</span>\n              <h4>{app.translator.trans('datlechin-discussion-overview.forum.views')}</h4>\n            </li>\n          ) : null}\n          <li className=\"users\">\n            <span className=\"number\">{participantCount}</span>\n            <h4>{app.translator.trans('datlechin-discussion-overview.forum.users')}</h4>\n          </li>\n          <li className=\"likes\">\n            <span className=\"number\">{posts[0].attribute('likesCount') || 0}</span>\n            <h4>{app.translator.trans('datlechin-discussion-overview.forum.likes')}</h4>\n          </li>\n          <li className=\"avatars\">\n            <div className=\"user-list\">\n              {Array.from(participantUsers).map((user: User) => (\n                <Tooltip key={user.id()} text={user.attribute('username')}>\n                  <Link href={app.route.user(user)}>{avatar(user)}</Link>\n                </Tooltip>\n              ))}\n            </div>\n          </li>\n        </ul>\n      </>\n    );\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport DiscussionOverview from './components/DiscussionOverview';\n\napp.initializers.add('datlechin/flarum-discussion-overview', () => {\n  extend(PostStream.prototype, 'oncreate', function () {\n    const postStream: HTMLElement | null = document.querySelector('.CommentPost div');\n\n    if (!postStream) {\n      return;\n    }\n\n    const discussion = this.discussion;\n\n    const div = document.createElement('div');\n    div.className = 'DiscussionOverview';\n\n    m.mount(postStream.appendChild(div), {\n      view: function () {\n        return m(DiscussionOverview, { discussion });\n      },\n    });\n  });\n});\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/Link'];","module.exports = flarum.core.compat['common/components/Tooltip'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/helpers/avatar'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/PostStream'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["Component","Link","Tooltip","avatar","app","DiscussionOverview","_Component","_this","_len","arguments","length","args","Array","_key","call","apply","concat","discussion","_inheritsLoose","_proto","prototype","oninit","vnode","attrs","view","posts","participantCount","attribute","lastPost","participantUsers","Set","forEach","post","user","add","m","'['","className","translator","trans","dayjs","createdAt","fromNow","href","route","lastPostedAt","replyCount","initializers","has","viewCount","from","map","key","id","text","default","extend","PostStream","postStream","document","querySelector","div","createElement","mount","appendChild","setPrototypeOf","t","o","Object","create","constructor","_setPrototypeOf","e","bind","__proto__"],"sourceRoot":""}